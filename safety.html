<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Health & Safety â€“ Tour Support System</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/mobile.css" />
</head>

<body>

    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="dashboard.html">
                <i class="fas fa-bus text-primary me-2"></i>
                <strong>Tour Support</strong>
            </a>

            <button class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item"><a class="nav-link" href="dashboard.html">Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" href="students.html">Students</a></li>
                    <li class="nav-item"><a class="nav-link" href="attendance.html">Attendance</a></li>
                    <li class="nav-item"><a class="nav-link" href="itinerary.html">Itinerary</a></li>
                    <li class="nav-item"><a class="nav-link active" href="safety.html">Safety</a></li>
                    <li class="nav-item"><a class="nav-link" href="documents.html">Documents</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- ALWAYS-VISIBLE EMERGENCY STRIP -->
    <div class="alert alert-danger text-center sticky-top mb-0">
        <strong>Emergency:</strong>
        <a href="tel:108" class="text-white text-decoration-underline ms-2">108 Ambulance</a> |
        <a href="tel:100" class="text-white text-decoration-underline ms-2">100 Police</a>
    </div>

    <!-- MAIN -->
    <main class="container py-4">

        <h2 class="mb-4">
            <i class="fas fa-shield-alt me-2"></i>Health & Safety
        </h2>

        <!-- EMERGENCY CONTACTS -->
        <div class="card border-danger mb-4">
            <div class="card-header bg-danger text-white d-flex justify-content-between align-items-center">
                <span><i class="fas fa-phone-alt me-2"></i>Emergency Contacts</span>
                <button class="btn btn-sm btn-light" onclick="window.print()">
                    <i class="fas fa-print"></i>
                </button>
            </div>
            <div class="card-body">
                <div class="row" id="emergencyContacts"></div>
            </div>
        </div>

        <!-- HEALTH ALERTS (MINIMAL, NON-SENSITIVE) -->
        <div class="card border-warning mb-4">
            <div class="card-header bg-warning d-flex justify-content-between">
                <span>
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Student Health Alerts
                </span>
                <span class="badge bg-dark" id="alertCount">0</span>
            </div>
            <div class="card-body">
                <div class="row" id="healthAlerts"></div>
            </div>
        </div>

        <!-- FIRST AID CHECK -->
        <div class="card">
            <div class="card-header">
                <i class="fas fa-first-aid me-2"></i>First Aid Checklist
            </div>
            <div class="card-body">
                <div class="form-check">
                    <input class="form-check-input aid-item" id="bandages" type="checkbox">
                    <label class="form-check-label">Bandages</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input aid-item" id="antiseptic" type="checkbox">
                    <label class="form-check-label">Antiseptic</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input aid-item" id="painkillers" type="checkbox">
                    <label class="form-check-label">Pain relief tablets</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input aid-item" id="thermometer" type="checkbox">
                    <label class="form-check-label">Thermometer</label>
                </div>

                <hr />
                <button class="btn btn-sm btn-outline-secondary w-100" onclick="resetFirstAid()">
                    Reset Checklist
                </button>
            </div>
        </div>

    </main>

    <!-- SCRIPTS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/data-manager.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            if (!AuthSystem.isLoggedIn()) {
                window.location.replace('index.html');
                return;
            }

            loadEmergencyContacts();
            loadHealthAlerts();
            loadFirstAid();
        });

        /* ---------- EMERGENCY CONTACTS ---------- */
        function loadEmergencyContacts() {
            const data = DataManager.getData('safety')?.emergencyContacts || [];
            const box = document.getElementById('emergencyContacts');

            if (!data.length) {
                box.innerHTML = '<p class="text-muted text-center">No contacts available</p>';
                return;
            }

            box.innerHTML = data.map(c => `
                <div class="col-md-4 mb-3">
                    <div class="card border-danger h-100">
                        <div class="card-body text-center">
                            <h5>${c.type}</h5>
                            <h3 class="text-danger">${c.number}</h3>
                            <p class="text-muted">${c.location || ''}</p>
                            <a href="tel:${c.number.replace(/[^\d+]/g, '')}"
                               class="btn btn-danger w-100">
                                Call
                            </a>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        /* ---------- HEALTH ALERTS (NO MEDICAL DETAILS) ---------- */
        function loadHealthAlerts() {
            const students = DataManager.getData('students') || [];
            const alerts = students.filter(s => s.healthAlert);
            document.getElementById('alertCount').textContent = alerts.length;

            const box = document.getElementById('healthAlerts');

            if (!alerts.length) {
                box.innerHTML =
                    '<p class="text-success text-center">No active health alerts</p>';
                return;
            }

            box.innerHTML = alerts.map(s => `
                <div class="col-md-6 mb-3">
                    <div class="card border-warning">
                        <div class="card-body">
                            <h5>${s.fullName}</h5>
                            <p class="text-muted">Health attention required</p>
                            <a href="tel:${s.emergencyContact}"
                               class="btn btn-warning btn-sm">
                                Call Emergency Contact
                            </a>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        /* ---------- FIRST AID CHECKLIST ---------- */
        function loadFirstAid() {
            const saved = JSON.parse(localStorage.getItem('firstAidChecklist') || '{}');

            document.querySelectorAll('.aid-item').forEach(cb => {
                cb.checked = !!saved[cb.id];
                cb.addEventListener('change', saveFirstAid);
            });
        }

        function saveFirstAid() {
            const data = {};
            document.querySelectorAll('.aid-item')
                .forEach(cb => data[cb.id] = cb.checked);
            localStorage.setItem('firstAidChecklist', JSON.stringify(data));
        }

        function resetFirstAid() {
            if (!confirm('Reset first aid checklist?')) return;
            document.querySelectorAll('.aid-item').forEach(cb => cb.checked = false);
            saveFirstAid();
        }
    </script>

</body>

</html>